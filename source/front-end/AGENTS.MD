# BS Beauty Frontend - Guia para Agentes de IA

## üìã Vis√£o Geral
Sistema de agendamento de beleza com React + TypeScript + Vite, usando Redux Toolkit Query, autentica√ß√£o JWT e controle de permiss√µes baseado em roles.

## üèóÔ∏è Arquitetura Principal

### Sistema de Autentica√ß√£o
- **SessionBootstrap**: Inicializa√ß√£o autom√°tica de sess√£o com refresh tokens
- **Tokens JWT**: Access token + refresh token com rota√ß√£o autom√°tica
- **Mutex de Refresh**: Controle de concorr√™ncia em `src/store/fetch-base/custom-fetch-base.ts`
- **Persist√™ncia**: localStorage para tokens, cookies httpOnly para refresh

### Tipos de Usu√°rio e Permiss√µes
```typescript
enum UserType {
  MANAGER = "MANAGER",     // Acesso total
  PROFESSIONAL = "PROFESSIONAL", // Gerencia servi√ßos/turnos
  CUSTOMER = "CUSTOMER"    // Agenda atendimentos
}
```

### Estrutura de Rotas com Prote√ß√£o
- Rotas p√∫blicas: `/login`, `/register`, `/reset-password`
- Prote√ß√£o por role usando `PrivateRoute` com `allowedUserTypes[]`
- Sidebar autom√°tica para usu√°rios autenticados
- Redirecionamento espec√≠fico por tipo de usu√°rio

### Redux + RTK Query
- **Store centralizado**: `src/store/index.ts` com m√∫ltiplas APIs
- **Padr√£o de APIs**: Cada dom√≠nio tem sua pr√≥pria API slice (auth-api, user-api, etc.)
- **Cache e Tags**: Invalida√ß√£o autom√°tica com `providesTags`/`invalidatesTags`
- **Base Query Customizada**: Auto-refresh de tokens em `custom-fetch-base.ts`

## üìù Conven√ß√µes de C√≥digo

### Componentes
- **Diret√≥rio**: `src/components/[categoria]/ComponentName.tsx`
- **Props Interface**: Sempre exportar interface de props
- **Styling**: TailwindCSS com classes condicionais via `clsx`
- **Variantes**: Props para diferentes estilos (ex: `variant="outline"|"solid"`)

### Estado e APIs
```typescript
// Hook padr√£o para dispatch
import useAppDispatch from './hooks/use-app-dispatch'

// Hook padr√£o para sele√ß√£o de estado
import useAppSelector from './hooks/use-app-selector'

// Padr√£o RTK Query
export const entityAPI = createApi({
  reducerPath: 'entity-api',
  baseQuery: baseQueryWithAuth, // SEMPRE usar esta base
  tagTypes: ['Entity'],
  endpoints: (builder) => ({...})
})
```

### Estiliza√ß√£o
- **Tema**: Paleta de cores definida em `tailwind.config.js`
- **Cores prim√°rias**: `primary-{0-900}` (cinzas)
- **Cores secund√°rias**: `secondary-{100-700}` (tons terrosos)
- **Background principal**: `bg-[#1E1E1E]` (escuro)

## üéØ Padr√µes Espec√≠ficos do Projeto

### Formul√°rios
- **React Hook Form** + **Zod** para valida√ß√£o
- Componentes de input personalizados em `src/components/inputs/`
- Valida√ß√£o centralizada em `src/utils/validation/`

### P√°ginas
- **Estrutura**: `src/pages/[nome]/index.tsx`
- **Subcomponentes**: `src/pages/[nome]/components/`
- **Tipos**: `src/pages/[nome]/types/`

### Configura√ß√£o de API
- **Base URL**: Din√¢mica baseada em `ENV.ENVIRONMENT`
- **Endpoints**: Centralizados em `src/api/config.ts`
- **Credentials**: Sempre `include` para cookies

### Toast Notifications
- **React-Toastify** configurado globalmente no App.tsx
- Styling customizado para tema escuro
- Usar `toast.success()`, `toast.error()`, `toast.warn()`

## üîó Pontos de Integra√ß√£o

### Google OAuth
- Fluxo completo: redirect ‚Üí callback ‚Üí exchange code ‚Üí token
- Persist√™ncia de `googleAccessToken` separada

### Refresh Token Flow
- Autom√°tico antes de cada requisi√ß√£o
- Retry em 401 com novo token
- Logout autom√°tico em falha de refresh

### Permiss√µes Din√¢micas
- Verifica√ß√£o em componentes: `userHasPermission(allowedTypes, currentType)`
- Controle de renderiza√ß√£o baseado em roles
- Rotas protegidas com valida√ß√£o server-side

### Estado de Loading/Erro
- Componentes `Loading` e `ErrorMessage` padronizados
- Estados RTK Query: `isLoading`, `isError`, `data`

## ‚ö° Comandos Essenciais
```bash
npm run dev          # Desenvolvimento local
npm run build        # Build de produ√ß√£o
npm run lint         # ESLint
npm run lint:fix     # ESLint com corre√ß√£o autom√°tica
npm run preview      # Preview do build
```

## üö´ O que N√ÉO fazer

### M√°s Pr√°ticas
- **N√ÉO** coloque l√≥gica de neg√≥cio nos componentes - use hooks personalizados
- **N√ÉO** acesse APIs diretamente nos componentes - use RTK Query hooks
- **N√ÉO** misture responsabilidades entre componentes de apresenta√ß√£o e l√≥gica
- **N√ÉO** esque√ßa de adicionar valida√ß√µes de entrada com Zod
- **N√ÉO** implemente sem considerar estados de loading/error
- **N√ÉO** quebre conven√ß√µes de nomenclatura (PascalCase para componentes)
- **N√ÉO** ignore tratamento de erros - sempre use try/catch ou error boundaries
- **N√ÉO** fa√ßa commits sem executar lint
- **N√ÉO** duplique c√≥digo - sempre aplique o princ√≠pio DRY (Don't Repeat Yourself)

### Erros Comuns
- N√£o adicionar newline no final dos arquivos
- Usar imports relativos em vez de absolutos quando poss√≠vel
- Esquecer de exportar componentes/interfaces
- N√£o mockar depend√™ncias nos testes
- N√£o seguir o padr√£o strict do Zod (`.strict()`)
- **Duplicar l√≥gica entre componentes** - sempre extrair para hooks personalizados
- Criar componentes redundantes quando um pode servir ambos os prop√≥sitos
- **Adicionar coment√°rios desnecess√°rios** - evite coment√°rios √≥bvios no c√≥digo
- **Usar mensagens de erro em portugu√™s no console** - sempre use ingl√™s

### Princ√≠pio DRY - Hooks Personalizados
```typescript
// ‚ùå MAU - L√≥gica duplicada em componentes
function CustomerList() {
  const [customers, setCustomers] = useState([])
  const [loading, setLoading] = useState(false)
  // ... l√≥gica de fetch, pagina√ß√£o, filtros
}

function ProfessionalList() {
  const [professionals, setProfessionals] = useState([])
  const [loading, setLoading] = useState(false)
  // ... mesma l√≥gica duplicada
}

// ‚úÖ BOM - Hook reutiliz√°vel
function useEntityList<T>(apiHook: any, initialFilters = {}) {
  const [filters, setFilters] = useState(initialFilters)
  const { data, isLoading, error } = apiHook(filters)
  
  return {
    data: data?.data || [],
    loading: isLoading,
    error,
    filters,
    setFilters,
  }
}
```

### Baixo Acoplamento, Alta Coes√£o
- **Componentes**: Apenas apresenta√ß√£o e intera√ß√£o do usu√°rio
- **Hooks personalizados**: L√≥gica de neg√≥cio e gerenciamento de estado
- **RTK Query**: Comunica√ß√£o com APIs
- **Utils**: Fun√ß√µes puras reutiliz√°veis

## üìã Como Implementar Nova Funcionalidade

### 1. Estrutura de Arquivos
```
src/pages/nova-feature/
‚îú‚îÄ‚îÄ index.tsx              # P√°gina principal
‚îú‚îÄ‚îÄ components/            # Componentes espec√≠ficos
‚îÇ   ‚îú‚îÄ‚îÄ FeatureForm.tsx
‚îÇ   ‚îî‚îÄ‚îÄ FeatureList.tsx
‚îî‚îÄ‚îÄ types/                 # Tipos espec√≠ficos
    ‚îî‚îÄ‚îÄ index.ts
```

### 2. Fluxo de Implementa√ß√£o

#### Passo 1: Definir Types e API
```typescript
// src/pages/nova-feature/types/index.ts
export interface Feature {
  id: string
  name: string
  // ... outros campos
}

// src/api/config.ts - Adicionar endpoints
FEATURE_ENDPOINTS: {
  ENDPOINT: '/features',
  FIND_BY_ID: (id: string) => `/features/${id}`,
}
```

#### Passo 2: Criar RTK Query Slice
```typescript
// src/store/feature/feature-api.ts
export const featureAPI = createApi({
  reducerPath: 'feature-api',
  baseQuery: baseQueryWithAuth,
  tagTypes: ['Feature'],
  endpoints: (builder) => ({
    // ... endpoints
  })
})
```

#### Passo 3: Hook Personalizado (Abstrair L√≥gica)
```typescript
// src/pages/nova-feature/hooks/useFeatureLogic.ts
export function useFeatureLogic() {
  const { data: features, isLoading } = useGetFeaturesQuery()
  const [createFeature] = useCreateFeatureMutation()
  
  const handleCreate = useCallback(async (data: CreateFeatureRequest) => {
    try {
      await createFeature(data).unwrap()
      toast.success('Feature criada com sucesso!')
    } catch (error) {
      toast.error('Erro ao criar feature')
    }
  }, [createFeature])

  return {
    features,
    isLoading,
    handleCreate,
    // ... outras funcionalidades
  }
}
```

#### Passo 4: Componente de Apresenta√ß√£o Limpo
```typescript
// src/pages/nova-feature/index.tsx
export default function NovaFeature() {
  const { features, isLoading, handleCreate } = useFeatureLogic()
  
  if (isLoading) return <Loading />
  
  return (
    <div className="p-6">
      <Title label="Nova Feature" />
      <FeatureForm onSubmit={handleCreate} />
      <FeatureList features={features} />
    </div>
  )
}
```

### 3. Integra√ß√£o com Sistema de Permiss√µes
```typescript
// Proteger rota se necess√°rio
<Route
  element={<PrivateRoute allowedUserTypes={[UserType.MANAGER]} />}
>
  <Route path="/features" element={<NovaFeature />} />
</Route>

// Ou condicional no componente
const { user } = useAppSelector(state => state.auth)
const canCreate = userHasPermission([UserType.MANAGER], user.userType)
```

### 4. Adicionar Item na Sidebar (Para Resources Isolados)
```typescript
// src/components/sidebar/consts/index.tsx - Adicionar no userType apropriado
[UserType.MANAGER]: [
  // ... outros itens existentes
  {
    name: 'Nome do Resource',
    icon: <IconeDoHeroicons className="size-6" />,
    navigateTo: '/caminho/para/resource',
  },
]
```

**‚ö†Ô∏è IMPORTANTE:** Apenas adicione itens na sidebar para resources **isolados e independentes** (ex: Roles, Permissions, Analytics). N√£o adicione para subp√°ginas ou funcionalidades que fazem parte de outro contexto.

## üìã Checklist para Nova Feature

### Antes de Come√ßar
- [ ] Definir tipos TypeScript necess√°rios
- [ ] Criar interfaces de API no arquivo de config
- [ ] Verificar permiss√µes necess√°rias por role

### Implementa√ß√£o
- [ ] Criar RTK Query API slice com tags apropriadas
- [ ] Implementar hook personalizado para l√≥gica de neg√≥cio
- [ ] Criar componentes de apresenta√ß√£o com props tipadas
- [ ] Adicionar valida√ß√£o Zod nos formul√°rios
- [ ] Implementar estados de loading/error/success
- [ ] Adicionar toast notifications apropriadas
- [ ] Configurar rotas protegidas se necess√°rio
- [ ] Adicionar item na sidebar (apenas para resources isolados)

### Finaliza√ß√£o
- [ ] Executar `npm run lint:fix`
- [ ] Testar diferentes roles de usu√°rio
- [ ] Verificar responsividade
- [ ] Testar fluxos de erro (network, valida√ß√£o, etc.)

## üêõ Debugging
- Redux DevTools habilitado
- Console logs detalhados no fluxo de auth
- Network tab para monitorar refresh tokens
- LocalStorage para verificar tokens persistidos